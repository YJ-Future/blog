# 深入拆解JVM
## 01 java代码怎么运行
- **java代码的运行方式**  
双击jar包运行、命令行、浏览器。依赖于JRE，java运行时环境。C++则不需要额外的运行时环境，编辑器把代码编译成机器码，直接可运行。
- **JRE中有什么**   
  包括运行java程序必需的组件：java虚拟机、java核心类库等
- **JDK中有什么**    
  包括JRE、以及开发和诊断工具
- **为什么java需要在jvm中运行**  
    java源代码编译成java字节码文件，然后运行在jvm中，而不是由编译器直接编译成机器码，直接运行在硬件上。  
    - 平台无关性    
    使用jvm java虚拟机屏蔽操作系统平台差异。在不同的操作系统平台提供不同的jvm，可以运行相同的字节码文件。
    - 提供托管环境  
    比如提供自动内存管理、垃圾回收等功能
- jvm具体怎样运行java字节码
    - jvm运行时数据区划分
        - 线程共享：
            - 堆：用于存放对象实例。
            - 方法区：用于方法被加载的类信息、常量、静态变量、JIT编译生成的代码等数据。
        - 线程私有：
            - java方法栈：每个方法开始执行时，都会在该线程对应的java方法栈中创建一个栈帧，栈帧中存放内容：局部变量表、操作数栈、动态链接、方法出口等。执行完该方法，则对应栈帧从栈中移出。栈帧的大小是提前计算好的，且不要求在内存空间中连续分布。
            - 本地方法栈：用于C++编写的native方法，类似java方法栈。
            - PC寄存器：存放当前线程执行字节码的行号。
    - 虚拟机角度  
        1. 把编译好的java字节码文件加载到jvm中
        2. 把加载好的java类存放到jvm的方法区中
        3. jvm执行方法区中的代码
    
    - 硬件角度  
        java字节码无法直接运行，需要jvm把java字节码翻译成机器码。在HotSpot中，翻译方式有两种： 
        - 解释执行：逐条将字节码翻译成机器码，然后执行。
        - 及时编译（JIT）：将一个方法中包含的所有字节码编译成机器码之后再执行。
          
        优缺点对比：  
        
        | | 优点 | 缺点 |
        |:---:|:---:|:---:|
        |解释执行|不需要等待编译<br>能够让程序快速启动执行|执行效率较低|
        |及时编译|执行效率高|编译需要耗费相对较长时间|
        HotSpot默认采用混合模式：先解释执行字节码，然后将反复执行的热点代码，以方法为单位进行及时编译。
- jvm运行效率  
HotSpot采用多种技术提升启动性能、以及峰值性能。技术就包括及时编译。  
及时编译建立在二八定律假设上，百分之二十的代码占用了百分之八十的计算资源。对于百分之八十不常用的代码，使用解释执行方法运行；对于百分之二十的热点代码，采用及时编译成机器码，提高运行效率。  
及时编译相比于静态编译具有的优势：  
及时编译能获取到程序运行时的统计信息，根据运行时信息可以做出更多的优化，提高程序运行效率。  
例子：  
java面向对象具有多态的特性，对于一个虚方法调用，可能会对应多个目标方法，其实往往程序运行中只使用到其中一个，那么可以在及时编译时，直接使用目标方法，省去虚方法调用开销。  

HotSopt内置多个及时编译器：C1、C2、Graal（java10正式引入的实验性及时编译器）。  
 - C1：Client编译器，面向对启动性能有要求的客户端GUI程序。优化手段相对简单，编译时间较短，执行效率相对较低。
 - C2: Server编译器，面向对峰值性能有要求的服务端程序。优化手段相对复杂，编译时间较长，但执行效率较高。  
 java7开始，HotSpot默认采用分层编译，热点方法首先被C1编译，之后热点中的热点方法会被C2编译。  
 HotSpot即使编译会在单独的编译线程中进行，避免对应用的正常运行造成影响。
 HotSpot会根据CPU数量设置编译线程的数量，然后编译线程的数量按照1：2比例分配给C1和C2及时编译器。
          
## 02 Java的基本类型
        
        
       
    